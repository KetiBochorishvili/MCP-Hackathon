<!DOCTYPE html>
<html lang="ka">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ვაკანსიების ძიება</title>
    <link rel="stylesheet" href="styles/main.css">
</head>

<body>
    <div class="container">
        <!-- Input Page -->
        <div id="inputPage">
            <h1>იპოვე შესაბამისი ვაკანსიები მთელს მსოფლიოში</h1>
            <p class="description">აღწერე შენი სამუშაო გამოცდილება</p>

            <div class="input-card">
                <textarea placeholder="შეიყვანეთ ან ჩასვით თქვენი ტექსტი აქ..." id="analysisText"></textarea>
                <div class="char-count">0 სიმბოლო</div>
                <button class="analyze-btn" id="submitBtn">გაგზავნა</button>
            </div>
        </div>

        <!-- Results Page -->
        <div id="resultsPage" class="hidden">
            <div class="results-header">
                <div class="header-container">
                    <h2>სულ მოიძებნა <span id="jobCount">0</span> ვაკანსია</h2>
                    <button class="viz-btn" id="vizBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" />
                            <path d="M7 17V9" />
                            <path d="M11 17V12" />
                            <path d="M15 17V7" />
                            <path d="M19 17V13" />
                        </svg>
                        ვიზუალიზაცია
                    </button>
                </div>
            </div>
            <div id="jobCards" class="job-cards">
                <!-- Job cards will be inserted here dynamically -->
            </div>
        </div>

        <!-- Visualization Page -->
        <div id="vizPage" class="hidden">
            <div class="viz-header">
                <div class="header-container">
                    <h2>Top 8 ვაკანსია</h2>
                    <button class="back-btn" id="backBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M19 12H5" />
                            <path d="M12 19l-7-7 7-7" />
                        </svg>
                        უკან დაბრუნება
                    </button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="matchChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const textarea = document.getElementById('analysisText');
        const charCount = document.querySelector('.char-count');
        const submitBtn = document.getElementById('submitBtn');
        const inputPage = document.getElementById('inputPage');
        const resultsPage = document.getElementById('resultsPage');
        const jobCount = document.getElementById('jobCount');
        const jobCards = document.getElementById('jobCards');
        let submittedText = '';
        let currentPage = 1;
        const cardsPerPage = 8;
        let allJobs = [];
        let currentChart = null;

        // Add Chart.js script
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
        document.head.appendChild(script);

        script.onload = () => {
            console.log('Chart.js loaded');
        };

        function createBarChart(jobs) {
            const sortedJobs = [...jobs]
                .sort((a, b) => b.match - a.match)
                .slice(0, 8);

            // Calculate max value and add 10% buffer
            const maxValue = Math.max(...sortedJobs.map(job => job.match));
            const yAxisMax = Math.ceil((maxValue * 1.1) / 10) * 10; // Round up to nearest 10

            const ctx = document.getElementById('matchChart').getContext('2d');

            // Destroy existing chart if it exists
            if (currentChart) {
                currentChart.destroy();
            }

            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedJobs.map(job => job.company || ''),
                    datasets: [{
                        label: 'Match Percentage',
                        data: sortedJobs.map(job => job.match),
                        backgroundColor: 'rgba(53, 162, 235, 0.5)',
                        borderColor: 'rgb(53, 162, 235)',
                        borderWidth: 1,
                        borderRadius: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: yAxisMax,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                callback: value => `${value}%`,
                                color: '#666',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(53, 162, 235, 0.9)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            padding: 12,
                            cornerRadius: 4
                        }
                    }
                }
            });
        }

        function createJobCard(job) {
            const matchPercentage = job.match + '%';
            const card = document.createElement('div');
            card.className = 'job-card';

            // Determine match color based on new thresholds
            const getMatchColor = (match) => {
                if (match > 75) return '#2ecc71';  // Green for >75%
                if (match >= 40) return '#f1c40f';  // Yellow for 40-75%
                return '#e74c3c';  // Red for <40%
            };

            // Truncate description to 130 characters
            const truncatedDescription = job.description.length > 130
                ? job.description.substring(0, 130) + '...'
                : job.description;

            card.innerHTML = `
                <div class="job-card-header">
                    <div class="company-container">
                        ${job.company ? `<div class="company">${job.company}</div>` : ''}
                    </div>
                    <div class="match-container">
                        ${job.match ? `<div class="match" style="color: ${getMatchColor(job.match)}">${matchPercentage} match</div>` : ''}
                    </div>
                </div>
                ${job.title ? `<h3 class="job-title">${job.title}</h3>` : ''}
                ${job.description ? `<p class="job-description">${truncatedDescription}</p>` : ''}
                ${job.location ? `
                    <div class="location">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        ${job.location}
                    </div>
                ` : ''}
                <div class="job-footer">
                    ${job.salary ? `<div class="salary">${job.salary}${job.currency ? ` ${job.currency}` : ''}</div>` : ''}
                    ${job.date ? `<div class="date">${new Date(job.date).toLocaleDateString('ka-GE')}</div>` : ''}
                </div>
            `;

            return card;
        }

        function createPaginationControls(totalPages) {
            const paginationContainer = document.createElement('div');
            paginationContainer.className = 'pagination';

            // Previous button
            const prevButton = document.createElement('button');
            prevButton.innerHTML = '←';
            prevButton.className = 'pagination-btn';
            prevButton.disabled = currentPage === 1;
            prevButton.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayJobCards();
                }
            };

            // Next button
            const nextButton = document.createElement('button');
            nextButton.innerHTML = '→';
            nextButton.className = 'pagination-btn';
            nextButton.disabled = currentPage === totalPages;
            nextButton.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayJobCards();
                }
            };

            // Page numbers
            const pageNumbers = document.createElement('div');
            pageNumbers.className = 'page-numbers';
            pageNumbers.textContent = `გვერდი ${currentPage}/${totalPages}`;

            paginationContainer.appendChild(prevButton);
            paginationContainer.appendChild(pageNumbers);
            paginationContainer.appendChild(nextButton);

            return paginationContainer;
        }

        function displayJobCards() {
            const startIndex = (currentPage - 1) * cardsPerPage;
            const endIndex = startIndex + cardsPerPage;
            const currentJobs = allJobs.slice(startIndex, endIndex);

            jobCards.innerHTML = '';

            currentJobs.forEach(job => {
                const card = createJobCard(job);
                jobCards.appendChild(card);
            });

            const totalPages = Math.ceil(allJobs.length / cardsPerPage);

            // Remove existing pagination if any
            const existingPagination = document.querySelector('.pagination');
            if (existingPagination) {
                existingPagination.remove();
            }

            // Add pagination controls if there are multiple pages
            if (totalPages > 1) {
                const paginationControls = createPaginationControls(totalPages);
                jobCards.after(paginationControls);
            }
        }

        function displayResults(response) {
            inputPage.classList.add('hidden');
            resultsPage.classList.remove('hidden');

            if (Array.isArray(response.data)) {
                jobCount.textContent = response.data.length;
                allJobs = response.data;
                currentPage = 1;
                displayJobCards();
            } else {
                // If response.data is text
                jobCount.textContent = '0';
                jobCards.innerHTML = `<div class="text-response">${response.data}</div>`;
            }
        }

        submitBtn.addEventListener('click', async () => {
            const text = textarea.value.trim();
            if (!text) return;

            // Disable UI
            submitBtn.disabled = true;
            textarea.disabled = true;
            submitBtn.textContent = '';
            submitBtn.classList.add('success');

            // try {
            //     const resp = await fetch('http://localhost:3000/find_jobs_with_ai', {
            //         method: 'POST',
            //         mode: 'cors',                  // ← allow reading the response
            //         headers: {
            //             'Content-Type': 'application/json'
            //         },
            //         body: JSON.stringify({ userPrompt: text })
            //     });

            //     if (!resp.ok) {
            //         throw new Error(`Server returned ${resp.status}`);
            //     }

            //     const json = await resp.json();    // now you can parse it!
            //     const jobs = json.data;            // adjust if your payload is under a different key

            //     // show the real results
            //     displayResults(jobs);

            // } catch (error) {
            //     console.error('Error fetching jobs:', error);

            //     // Restore UI on error
            //     submitBtn.disabled = false;
            //     textarea.disabled = false;
            //     submitBtn.classList.remove('success');
            //     submitBtn.textContent = 'გაგზავნა';
            // }

            const jobs = [
                    {
                        "title": "სტაჟიორი ERP სისტემის მიმართულებით",
                        "jobUrl": "https://jobs.ge/ge/?view=jobs&id=631461",
                        "company": "ნიკორა",
                        "isNew": true,
                        "date": "02 მაისი",
                        "endsAt": "02 ივნისი",
                        "salaryMin": "800",
                        "salaryMax": "800",
                        "currency": "ლარი",
                        "description": "კომპანია \"ნიკორა\" 1998 წელს ქართული კაპიტალით დაარსდა. დღესდღეობით \"ნიკორა ჯგუფი\" წარმოდგენილია ჰოლდინგის სახით, რომელიც აერთიანებს თოთხმეტ შვილობილ კომპანიას. ჰოლდინგში წარმოდგენილი კომპანიები უმაღლესი ხარისხის ნედლეულის გამოყენებითა და თანამედროვე ტექნოლოგიების დაცვით მომხმარებელს მრავალფეროვან ასორტიმენტს სთავაზობს, როგორიცაა: ხორცპროდუქტები, ნახევარფაბრიკატები, თევზეული, რძის პროდუქტები, ნაყინი, პურ-ფუნთუშეული. კომპანიას, ასევე, აქვს საკუთარი სადისტრიბუციო ქსელი, მაღაზიათა ქსელი საქართველოს მასშტაბით და საკალმახე მეურნეობა. \"ნიკორა ჯგუფი\" არის მაღალი ხარისხის საკვები პროდუქტების, ალკოჰოლური და არაალკოჰოლური სასმელების ექსკლუზიური იმპორტიორი საქართველოში. კომპანიის მთავარი მიზანია - განვითარება, გაფართოებისკენ მუდმივი სწრაფვა, სიახლეების ათვისება, სოციალური პასუხისმგებლობა, პარტნიორებთან გრძელვადიანი თანამშრომლობა და მომხმარებლის ერთგულების მოპოვება. \"ნიკორა ჯგუფი\" ქართულ ბაზარზე ერთ-ერთი აქტიური დამსაქმებელია. ამჟამად, ჰოლდინგში 10000-ზე მეტი თანამშრომელია და კომპანიის განვითარებასთან ერთად დასაქმებულთა რაოდენობა მუდმივად იზრდება. სრული ინფორმაციისათვის გადადით ჩვენს საიტზე: http://www.nikora.ge სს \"ნიკორას\" შვილობილი კომპანია შპს \"ნიკორა\" აცხადებს ვაკანსიას სტაჟიორი ERP სისტემის მიმართულებით: სამუშაო პირობები: ** სამუშაო ადგილი: ნაძალადევი, ალ. მრევლიშვილის #2; ** ანაზღაურება: 800 ლარი. ძირითადი ფუნქცია-მოვალეობები: ** სისტემის გატესტვაში მონაწილეობის მიღება; ** ლიცენზიების აღრიცხვა/მართვა; ** ბაზების მოვლა, ბექაფირება და დაცულად შენახვის უზრუნველყოფა; ** სისტემის გაუმჯობესებაში მონაწილეობის მიღება. ძირითადი მოთხოვნები: ** ინგლისური ენის კარგად ცოდნა; ** Excel-ის კარგად ცოდნა; ** ERP პროდუქტებთან მუშაობის გამოცდილება ჩაითვლება უპირატესობად; პიროვნული უნარ-ჩვევები: ** ტექნოლოგიური აზროვნების უნარი; ** შედეგებზე ორიენტირებულობა; ** მაღალი პასუხისმგებლობის გრძნობა; ** გუნდური მუშაობის უნარი; ** პრობლემის დროული იდენტიფიცირებისა და აღმოფხვრის უნარი; ** ოპერატიულობა. თუ დაინტერესდით ჩვენი ვაკანსიით და აკმაყოფილებთ ზემოთ მოყვანილ მოთხოვნებს, გთხოვთ გაეცანით ქვემოთ მოცემულ ინფორმაციას პერსონალური მონაცემების დამუშავების შესახებ და შემდეგ გამოაგზავნეთ თქვენი CV/რეზიუმე მისამართზე: jobs@nikora.ge სათაურის ველში გთხოვთ მიუთითეთ ვაკანსიის დასახელება, წინააღმდეგ შემთხვევაში თქვენი კანდიდატურა არ განიხილება. გაცნობებთ, რომ თქვენს მიერ მოწოდებული ინფორმაცია, რომელიც შეიცვას პერსონალურ მონაცემებს, დამუშავდება შპს ნიკორა ს/კ 400132183 და უფლებამოსილი პირის - სს \"ნიკორას\" ს/კ 200050675 (რეგისტრირებული მისამართი: ქ. თბილისი ალექსანდრე მრევლიშვილის ქ. #2) მიერ \"პერსონალურ მონაცემთა დაცვის შესახებ\" საქართველოს კანონის შესაბამისად დასაქმების მსურველი პირის/კანდიდატის არსებულ და/ან სამომავლო ვაკანსიის მოთხოვნებთან შესაბამისობის დადგენისა და დასაქმებისათვის საჭირო პროცედურების წარმართვის მიზნით. შესაბამისად, მოთხოვნილი ინფორმაციის მიუწოდებლობის შემთხვევაში, მოკლებული ვართ შესაძლებლობას განვიხილოთ თქვენი კანდიდატურა. მონაცემები ინახება არაუმეტეს 1 (ერთი) წლის ვადით. ამასთანავე, გაცნობებთ, რომ \"პერსონალურ მონაცემთა დაცვის შესახებ\" საქართველოს კანონის თანახმად, უფლება გაქვთ ნებისმიერ დროს მიიღოთ ინფორმაცია თქვენს შესახებ დამუშავებულ მონაცემთა თაობაზე, მოითხოვოთ მათი გაცნობა, ასლის მიღება, მცდარი არაზუსტი მონაცემების გასწორება, განახლება, შევსება, ასევე მონაცემთა გადატანა, დაბლოკვა, დამუშავების შეწყვეტა, წაშლა ან განადგურება, თუ არ არსებობს მონაცემთა სუბიექტის უფლებების შეზღუდვის საფუძველი, წერილობით შემდეგ ელ. ფოსტაზე contact@nikora.ge შეტყობინების გაგზავნის გზით ან/და ფოსტის მეშვეობით შპს ნიკორა ს/კ 400132183 იურიდიულ მისამართზე: ქ. თბილისი ალ. მრევლიშვილის ქ. №2. შპს ნიკორა ს/კ 400132183 კანდიდატთა შერჩევის პროცესს ახორციელებს დისკრიმინაციის ყველა ფორმით აღმოფხვრის შესახებ კანონის მოთხოვნათა და პირთა მიმართ თანაბარი მოპყრობის პრინციპების დაცვით და გამორიცხავს პირთა მიმართ დისკრიმინაციას ნებისმიერი ნიშნით. დისკრიმინაციისგან დაცვა ასევე უზრუნველყოფილია შრომითი ურთიერთობის ნებისმიერ ეტაპზე.",
                        "englishVersion": false,
                        "match": 0
                    },
                    {
                        "title": "მონაცემთა ბაზის ოპერატორი",
                        "jobUrl": "https://jobs.ge/ge/?view=jobs&id=630667",
                        "company": "შარმ ტრეიდინგი",
                        "isNew": false,
                        "date": "30 აპრილი",
                        "endsAt": "30 მაისი",
                        "salaryMin": "1000",
                        "salaryMax": "1000",
                        "currency": "ლარი",
                        "description": "\"შარმ ტრეიდინგი\" გახლავთ წამყვანი სადისტრიბუციო კომპანია საქართველოში, რომელიც დაარსდა 1998 წელს და მას შემდეგ ინარჩუნებს ლიდერ პოზიციებს. \"შარმ ტრეიდინგი\" ახორციელებს მსოფლიო წამყვანი ბრენდების ექსკლუზიურ დისტრიბუციას საქართველოს მასშტაბით \"Schwarzkopf, Henkel, Unilever, Carlsberg, Selpak, Algida და სხვა.\" კომპანია \"შარმ ტრეიდინგი\" აცხადებს ვაკანსიას, მონაცემთა ბაზის ოპერატორის (1C პროგრამაში) პოზიციაზე. ადგილმდებარეობა: თბილისი (დიღომი) სამუშაო განაკვეთი: ორშაბათი-პარასკევი, 09:00-18:00 ან ცვლები 08:00-16:00 ან 16:00-00:00 ანაზღაურება - ანაზღაურებადი სტაჟირება (მაქსიმუმ 1 თვე), სტაჟირების შემდეგ 800-1000 ლარი ფუნქცია-მოვალეობები: ** სააღრიცხვო პროგრამაში მონაცემების შეყვანა, დამუშავება; ** შეკვეთების მომზადება და კორექტირება; ** ელექტრონული სასაქონლო ზედნადების და ანგარიშფაქტურის გააქტიურება და გადაგზავნა. აუცილებელი მოთხოვნები: ** სასურველია უმაღლესი განათლება ან დამამთავრებელი კურსის სტუდენტი ** Microsoft Excel-ის საშუალო დონეზე ცოდნა ** სააღრიცხვო პროგრამა 1C-ის ცოდნა ჩაითვლება უპირატესობად რას გთავაზობთ? ** ჯანმრთელობის დაზღვევას (6 თვის შემდეგ) ** კომფორტულ სამუშაო გარემოს ** თანამშრომლის საჭიროებებზე მორგებულ ინსტრუმენტებს ** კარიერული განვითარების შესაძლებლობას ** ეტაპობრივ წინსვლასა და ბენეფიტებს დამატებითი უნარები: ** ორგანიზებული ** ენერგიული ** დეტალებზე ორიენტირებული ** კომუნიკაბელური ** მიზანდასახული ** დამოუკიდებლად მუშაობის უნარი დაინტერესებულ პირებს გთხოვთ გადმოაგზავნოთ CV ელფოსტაზე: vacancy@sharmtrading.ge. სათაურში მიუთითეთ პოზიციის დასახელება \"მონაცემთა ბაზის ოპერატორი\". კომპანია \"შარმ ტრეიდინგი\" პატივს სცემს პერსონალურ მონაცემთა დაცვის თაობაზე მოქმედ რეგულაციებს და თავის საქმიანობას წარმართავს \"პერსონალურ მონაცემთა დაცვის შესახებ\" საქართველოს კანონის მოთხოვნათა შესაბამისად. ნებისმიერი პერსონალური მონაცემი, რომელიც შპს \"შარმ ტრეიდინგისთვის\" ხელმისაწვდომი გახდება კომპანიაში გამოცხადებულ ამა თუ იმ ვაკანსიაზე განაცხადების განხილვისას, რაც მოიცავს, მაგრამ არ შემოიფარგლება თქვენს CV-სა ან/და მის თანდართულ დოკუმენტებში მოცემული მონაცემებით (შემდგომში \"კანდიდატის პერსონალური მონაცემები\"), შეგროვდება და დამუშავდება ვაკანსიაზე თქვენი განაცხადის შენახვისა და განხილვის, ასევე კანდიდატთა შერჩევის პროცესში თქვენი დაშვების მიზნით და საქართველოს მოქმედი კანონმდებლობის შესაბამისად. გაითვალისწინეთ, რომ კანდიდატის პერსონალური მონაცემების კომპანია \"შარმ ტრეიდინგისთვის\" გაგზავნით, თქვენ ადასტურებთ, რომ გაეცანით წინამდებარე შეტყობინებას და თანახმა ხართ, თქვენი პერსონალური მონაცემები შეგროვდეს, შენახულ იქნას, გადაიცეს ან/და დამუშავდეს ზემოთ ხსენებული ფორმით. ყოველივე აღნიშნულზე თანხმობა აუცილებელი პირობაა \"შარმ ტრეიდინგში\" ნებისმიერ პოზიციაზე თქვენი კანდიდატურის განსახილველად. გისურვებთ წარმატებას!",
                        "englishVersion": false,
                        "match": 0
                    }
                ]
console.log({jobs})
                displayResults(jobs)

        });

        // Add event listeners for visualization
        document.getElementById('vizBtn').addEventListener('click', () => {
            document.getElementById('resultsPage').classList.add('hidden');
            document.getElementById('vizPage').classList.remove('hidden');
            createBarChart(allJobs);
        });

        document.getElementById('backBtn').addEventListener('click', () => {
            document.getElementById('vizPage').classList.add('hidden');
            document.getElementById('resultsPage').classList.remove('hidden');
            // Optionally destroy the chart when going back
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
        });

        textarea.addEventListener('input', () => {
            const count = textarea.value.length;
            charCount.textContent = `${count} სიმბოლო`;
        });
    </script>
</body>

</html>